
<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="never" />
    <meta property="og:description" content="On an&amp;#160;NxN&amp;#160;chessboard, a knight starts at the&amp;#160;r-th row and&amp;#160;c-th column and attemp" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>[LeetCode] Knight Probability in Chessboard 棋盘上骑士的可能性 - Grandyang - 博客园</title>
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=PyyhYDRKBG1sYtpoHme_xHO5AMd5iN57I45iBKF8FVY" />
    <link id="MainCss" rel="stylesheet" href="/skins/unlimitedsunlight/bundle-unlimitedsunlight.min.css?v=0PW-IbyD73rSsrHXyZPdWAdlgI9zvcQ6P3MLE4OIhi4" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/unlimitedsunlight/bundle-unlimitedsunlight-mobile.min.css?v=1PFKcj_AbkIURdVbGrJ7RA7MSm_08tLLOsnXtqTHyME" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/grandyang/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/grandyang/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/grandyang/wlwmanifest.xml" />
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=F-Iy-_Lj7VcUKRIvNkS6UZ5LItMqjh1_L0VZk9Yxfb8"></script>
    <script>
        var currentBlogId = 198221;
        var currentBlogApp = 'grandyang';
        var cb_enable_mathjax = true;
        var isLogined = false;
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
        tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processClass: 'math', processEscapes: true },
        TeX: {
        equationNumbers: { autoNumber: ['AMS'], useLabelIds: true },
        extensions: ['extpfeil.js', 'mediawiki-texvc.js'],
        Macros: {bm: "\\boldsymbol"}
        },
        'HTML-CSS': { linebreaks: { automatic: true } },
        SVG: { linebreaks: { automatic: true } }
        });
    </script>
    <script src="https://mathjax.cnblogs.com/2_7_5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
</head>
<body>
    <a name="top"></a>
    <div id="page_begin_html">
        <a href="https://github.com/grandyang"> 
<img style="position: absolute; top: 0; left: 0; border: 0; z-index:9999;" 
src="https://github.blog/wp-content/uploads/2008/12/forkme_left_gray_6d6d6d.png" 
alt="Fork me on GitHub"> 
</a>

<script src="https://files.cnblogs.com/files/grandyang/tctip-1.0.4.js" defer></script>
<script>
new tctip({
top: '20%',
button: {
  id:7,
  type: 'zanzhu',
},
list: [
  {
        type: 'wechat',
	qrImg: 'https://files.cnblogs.com/files/grandyang/wepay.gif'
  }, {
	type: 'announcement',
        qrText: '2020，新的征途...'
  }
]
}).init()
</script>
    </div>
    
<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/grandyang/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/grandyang/">Grandyang</a>
</h1>
<h2>
仰天长啸仗剑红尘，冬去春来寒暑几更...
</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/grandyang/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/Grandyang">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/grandyang/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			
			<span id="stats_post_count">随笔 - 
1424&nbsp; </span>
<span id="stats_article_count">文章 - 
1&nbsp; </span>
<span id="stats-comment_count">评论 - 
4014</span>

			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class = "postTitle">
                
<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/grandyang/p/7639153.html">[LeetCode] Knight Probability in Chessboard 棋盘上骑士的可能性</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                
<div id="cnblogs_post_body" class="blogpost-body ">
    <p>&nbsp;</p>
<div class="question-description">
<p>On an&nbsp;<code>N</code>x<code>N</code>&nbsp;chessboard, a knight starts at the&nbsp;<code>r</code>-th row and&nbsp;<code>c</code>-th column and attempts to make exactly&nbsp;<code>K</code>&nbsp;moves. The rows and columns are 0 indexed, so the top-left square is&nbsp;<code>(0, 0)</code>, and the bottom-right square is&nbsp;<code>(N-1, N-1)</code>.</p>
<p>A chess knight has 8 possible moves it can make, as illustrated below. Each move is two squares in a cardinal direction, then one square in an orthogonal direction.</p>
<img src="https://leetcode.com/static/images/problemset/knight.png" alt="" />
<p>Each time the knight is to move, it chooses one of eight possible moves uniformly at random (even if the piece would go off the chessboard) and moves there.</p>
<p>The knight continues moving until it has made exactly&nbsp;<code>K</code>&nbsp;moves or has moved off the chessboard. Return the probability that the knight remains on the board after it has stopped moving.</p>
<p>Example:</p>
<pre>Input: 3, 2, 0, 0
Output: 0.0625
Explanation: There are two moves (to (1,2), (2,1)) that will keep the knight on the board.
From each of those positions, there are also two moves that will keep the knight on the board.
The total probability the knight stays on the board is 0.0625.
</pre>
<p>&nbsp;</p>
<p>Note:</p>
<ul>
<li><code>N</code>&nbsp;will be between 1 and 25.</li>
<li><code>K</code>&nbsp;will be between 0 and 100.</li>
<li>The knight always initially starts on the board.</li>
</ul>
<p>&nbsp;</p>
<p>这道题给了我们一个大小为NxN国际象棋棋盘，上面有个骑士，相当于我们中国象棋中的马，能走&lsquo;日&rsquo;字，给了我们一个起始位置，然后说允许我们走K步，问走完K步之后还能留在棋盘上的概率是多少。那么要求概率，我们必须要先分别求出分子和分母，其中分子是走完K步还在棋盘上的走法，分母是没有限制条件的总共的走法。那么分母最好算，每步走有8种跳法，那么K步就是8的K次方种了。关键是要求出分子，博主开始向的方法是以给定位置为起始点，然后进行BFS，每步遍历8种情况，遇到在棋盘上的就计数器加1，结果TLE了。上论坛看大家的解法，结果发现都是换了一个角度来解决问题的，并不很关心骑士的起始位置，而是把棋盘上所有位置上经过K步还留在棋盘上的走法总和都算出来，那么最后直接返回需要的值即可。跟之前那道<a href="http://www.cnblogs.com/grandyang/p/6927921.html">Out of Boundary Paths</a>没啥本质上的区别，又是换了一个马甲就不会了系列。还是要用DP来做，我们可以用三维DP数组，也可以用二维DP数组来做，这里为了省空间，我们就用二维DP数组来做，其中dp[i][j]表示在棋盘(i, j)位置上走完当前步骤还留在棋盘上的走法总和，初始化为1，我们其实将步骤这个维度当成了时间维度在不停更新。好，下面我们先写出8种&lsquo;日&rsquo;字走法的位置的坐标，就像之前遍历迷宫上下左右四个方向坐标一样，这不过这次位置变了而已。然后我们一步一步来遍历，每一步都需要完整遍历一遍棋盘的每个位置，新建一个临时数组t，大小和dp数组相同，但是初始化为0，然后对于遍历到的棋盘上的每一个格子，我们都遍历8中解法，如果新的位置不在棋盘上了，直接跳过，否则就加上上一步中的dp数组中对应的值，遍历完棋盘后，将dp数组更新为这个临时数组t，参见代码如下：</p>
<p>&nbsp;</p>
<p>解法一：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> Solution {
</span><span style="color: #0000ff;">public</span><span style="color: #000000;">:
    </span><span style="color: #0000ff;">double</span> knightProbability(<span style="color: #0000ff;">int</span> N, <span style="color: #0000ff;">int</span> K, <span style="color: #0000ff;">int</span> r, <span style="color: #0000ff;">int</span><span style="color: #000000;"> c) {
        </span><span style="color: #0000ff;">if</span> (K == <span style="color: #800080;">0</span>) <span style="color: #0000ff;">return</span> <span style="color: #800080;">1</span><span style="color: #000000;">;
        vector</span>&lt;vector&lt;<span style="color: #0000ff;">double</span>&gt;&gt; dp(N, vector&lt;<span style="color: #0000ff;">double</span>&gt;(N, <span style="color: #800080;">1</span><span style="color: #000000;">));
        vector</span>&lt;vector&lt;<span style="color: #0000ff;">int</span>&gt;&gt; dirs{{-<span style="color: #800080;">1</span>,-<span style="color: #800080;">2</span>},{-<span style="color: #800080;">2</span>,-<span style="color: #800080;">1</span>},{-<span style="color: #800080;">2</span>,<span style="color: #800080;">1</span>},{-<span style="color: #800080;">1</span>,<span style="color: #800080;">2</span>},{<span style="color: #800080;">1</span>,<span style="color: #800080;">2</span>},{<span style="color: #800080;">2</span>,<span style="color: #800080;">1</span>},{<span style="color: #800080;">2</span>,-<span style="color: #800080;">1</span>},{<span style="color: #800080;">1</span>,-<span style="color: #800080;">2</span><span style="color: #000000;">}};
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> m = <span style="color: #800080;">0</span>; m &lt; K; ++<span style="color: #000000;">m) {
            vector</span>&lt;vector&lt;<span style="color: #0000ff;">double</span>&gt;&gt; t(N, vector&lt;<span style="color: #0000ff;">double</span>&gt;(N, <span style="color: #800080;">0</span><span style="color: #000000;">));
            </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; N; ++<span style="color: #000000;">i) {
                </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> j = <span style="color: #800080;">0</span>; j &lt; N; ++<span style="color: #000000;">j) {
                    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (auto dir : dirs) {
                        </span><span style="color: #0000ff;">int</span> x = i + dir[<span style="color: #800080;">0</span>], y = j + dir[<span style="color: #800080;">1</span><span style="color: #000000;">];
                        </span><span style="color: #0000ff;">if</span> (x &lt; <span style="color: #800080;">0</span> || x &gt;= N || y &lt; <span style="color: #800080;">0</span> || y &gt;= N) <span style="color: #0000ff;">continue</span><span style="color: #000000;">;
                        t[i][j] </span>+=<span style="color: #000000;"> dp[x][y];
                    }
                }
            }
            dp </span>=<span style="color: #000000;"> t;
        }
        </span><span style="color: #0000ff;">return</span> dp[r][c] / pow(<span style="color: #800080;">8</span><span style="color: #000000;">, K);
    }
};</span></pre>
</div>
<p>&nbsp;</p>
<p>我们也可以使用有memo数组优化的递归来做，避免重复运算，从而能通过OJ。递归下的memo数组其实就是迭代下的dp数组，这里我们用三维的数组，初始化为0。在递归函数中，如果k为0了，说明已经走了k步，返回 1。如果memo[k][r][c]不为0，说明这种情况之前已经计算过，直接返回。然后遍历8种走法，计算新的位置，如果不在棋盘上就跳过；然后更新memo[k][r][c]，使其加上对新位置调用递归的返回值，注意此时带入k-1和新的位置，退出循环后返回memo[k][r][c]即可，参见代码如下：</p>
<p>&nbsp;</p>
<p>解法二：</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> Solution {
</span><span style="color: #0000ff;">public</span><span style="color: #000000;">:
    vector</span>&lt;vector&lt;<span style="color: #0000ff;">int</span>&gt;&gt; dirs{{-<span style="color: #800080;">1</span>,-<span style="color: #800080;">2</span>},{-<span style="color: #800080;">2</span>,-<span style="color: #800080;">1</span>},{-<span style="color: #800080;">2</span>,<span style="color: #800080;">1</span>},{-<span style="color: #800080;">1</span>,<span style="color: #800080;">2</span>},{<span style="color: #800080;">1</span>,<span style="color: #800080;">2</span>},{<span style="color: #800080;">2</span>,<span style="color: #800080;">1</span>},{<span style="color: #800080;">2</span>,-<span style="color: #800080;">1</span>},{<span style="color: #800080;">1</span>,-<span style="color: #800080;">2</span><span style="color: #000000;">}};
    </span><span style="color: #0000ff;">double</span> knightProbability(<span style="color: #0000ff;">int</span> N, <span style="color: #0000ff;">int</span> K, <span style="color: #0000ff;">int</span> r, <span style="color: #0000ff;">int</span><span style="color: #000000;"> c) {
        vector</span>&lt;vector&lt;vector&lt;<span style="color: #0000ff;">double</span>&gt;&gt;&gt; memo(K + <span style="color: #800080;">1</span>, vector&lt;vector&lt;<span style="color: #0000ff;">double</span>&gt;&gt;(N, vector&lt;<span style="color: #0000ff;">double</span>&gt;(N, <span style="color: #800080;">0.0</span><span style="color: #000000;">)));
        </span><span style="color: #0000ff;">return</span> helper(memo, N, K, r, c) / pow(<span style="color: #800080;">8</span><span style="color: #000000;">, K);
    }
    </span><span style="color: #0000ff;">double</span> helper(vector&lt;vector&lt;vector&lt;<span style="color: #0000ff;">double</span>&gt;&gt;&gt;&amp; memo, <span style="color: #0000ff;">int</span> N, <span style="color: #0000ff;">int</span> k, <span style="color: #0000ff;">int</span> r, <span style="color: #0000ff;">int</span><span style="color: #000000;"> c) {
        </span><span style="color: #0000ff;">if</span> (k == <span style="color: #800080;">0</span>) <span style="color: #0000ff;">return</span> <span style="color: #800080;">1.0</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">if</span> (memo[k][r][c] != <span style="color: #800080;">0.0</span>) <span style="color: #0000ff;">return</span><span style="color: #000000;"> memo[k][r][c];
        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (auto dir : dirs) {
            </span><span style="color: #0000ff;">int</span> x = r + dir[<span style="color: #800080;">0</span>], y = c + dir[<span style="color: #800080;">1</span><span style="color: #000000;">];
            </span><span style="color: #0000ff;">if</span> (x &lt; <span style="color: #800080;">0</span> || x &gt;= N || y &lt; <span style="color: #800080;">0</span> || y &gt;= N) <span style="color: #0000ff;">continue</span><span style="color: #000000;">;
            memo[k][r][c] </span>+= helper(memo, N, k - <span style="color: #800080;">1</span><span style="color: #000000;">, x, y);
        }
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> memo[k][r][c];
    }
};</span></pre>
</div>
<p>&nbsp;</p>
<p>类似题目：</p>
<p><a href="http://www.cnblogs.com/grandyang/p/6927921.html">Out of Boundary Paths</a></p>
<p>&nbsp;</p>
<p>参考资料：</p>
<p><a href="https://discuss.leetcode.com/topic/105571/my-accepted-dp-solution" target="_blank">https://discuss.leetcode.com/topic/105571/my-accepted-dp-solution</a></p>
<p><a href="https://discuss.leetcode.com/topic/105597/c-java-dp-concise-solution" target="_blank">https://discuss.leetcode.com/topic/105597/c-java-dp-concise-solution</a></p>
<p>&nbsp;</p>
<p><a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/grandyang/p/4606334.html">LeetCode All in One 题目讲解汇总(持续更新中...)</a></p>
</div>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2017-10-08 23:29</span>&nbsp;
<a href="https://www.cnblogs.com/grandyang/">Grandyang</a>&nbsp;
阅读(<span id="post_view_count">...</span>)&nbsp;
评论(<span id="post_comment_count">...</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=7639153" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(7639153);return false;">收藏</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 198221, cb_blogApp = 'grandyang', cb_blogUserGuid = '02affae8-0e77-e111-aa3f-842b2b196315';
    var cb_entryId = 7639153, cb_entryCreatedDate = '2017-10-08 23:29', cb_postType = 1; 
    loadViewCount(cb_entryId);
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>

<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
    </script>
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot("/1090369/C1", [300, 250], "div-gpt-ad-1546353474406-0").addService(googletag.pubads());
            googletag.defineSlot("/1090369/C2", [468, 60], "div-gpt-ad-1539008685004-0").addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;">
            <script>
                if (new Date() >= new Date(2018, 9, 13)) {
                    googletag.cmd.push(function () { googletag.display("div-gpt-ad-1539008685004-0"); });
                }
            </script>
        </div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>
	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>

			<div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright &copy; 2020 Grandyang
<br /><span id="poweredby">Powered by .NET Core 3.1.0 on Linux</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    <div id="page_end_html">
        <a href="https://github.com/grandyang"> 
<img style="position: absolute; top: 0; left: 0; border: 0; z-index:9999;" 
src="https://github.blog/wp-content/uploads/2008/12/forkme_left_gray_6d6d6d.png" 
alt="Fork me on GitHub"> 
</a>

<script src="https://files.cnblogs.com/files/grandyang/tctip-1.0.4.js" defer></script>
<script>
new tctip({
top: '20%',
button: {
  id:7,
  type: 'zanzhu',
},
list: [
  {
        type: 'wechat',
	qrImg: 'https://files.cnblogs.com/files/grandyang/wepay.gif'
  }, {
	type: 'announcement',
        qrText: '2020，新的征途...'
  }
]
}).init()
</script>
    </div>
</body>
</html>